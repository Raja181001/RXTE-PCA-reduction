#!/bin/bash

# Get the list of directories ending with "result"
directories=$(find . -maxdepth 1 -type d -name "*result" -printf "%f\n")

# Define ranges for each iteration
range1="7-14"
range2="14-21"
range3="22-48"

# Iterate over the directories
for directory in $directories; do
    cd $directory
    mkdir -p Analysis
    cd ..

    # Run the script 3 times with different event names
    for i in {1..3}; do
        event_name="color${i}"
        range_var="range${i}"

        # Create a script for each directory
        script_content="@${directory}/FP_dtstd2.lis
-
${directory}/Analysis/good.gti
${directory}/Analysis/${event_name}
ONE
TIME
GOOD
16
LIGHTCURVE
RATE
SUM
INDEF
INDEF
INDEF
INDEF
INDEF
${!range_var}
INDEF"

        script_file="${directory}/scriptpower_${i}.txt"
        echo "$script_content" > "$script_file"

        # Execute saextrct using the generated script
        saextrct < "$script_file"

        echo "saextrct executed for directory: $directory, iteration: $i"
    done
done
